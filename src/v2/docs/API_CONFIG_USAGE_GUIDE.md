# API 配置页面使用指南

## 功能概述

新增的 API 配置页面允许您管理多个 Clash API 连接配置，当检测到当前 API 接口不通时，可以方便地添加新的 API 地址和密钥。

## 访问方式

1. **通过侧边栏菜单**：点击左侧导航栏中的 "API 配置" 菜单项
2. **直接访问**：在浏览器地址栏输入 `#api-config`
3. **URL 访问**：http://localhost:3002/index.v2.html#api-config

## 主要功能

### 🔍 自动检测当前 API 状态
- 页面加载时自动检测当前 API 连接状态
- 显示连接状态指示器（正常/异常）
- 当 API 连接异常时，会显示醒目的警告提示

### 📋 API 配置列表管理
- 查看所有已配置的 API 连接
- 显示每个配置的名称、地址和连接状态
- 支持在不同 API 配置之间切换
- 可以删除不需要的配置（第一个默认配置除外）

### ➕ 添加新的 API 配置
- 点击 "添加新配置" 按钮打开配置表单
- 支持设置显示名称、API 地址和密钥
- 内置连接测试功能，确保配置有效
- 自动验证 Clash 版本信息

### 🧪 连接测试功能
- 每个配置都可以单独测试连接
- 实时显示测试结果和 Clash 版本
- 测试失败时显示详细错误信息

## 使用场景

### 场景 1：当前 API 连接异常
1. 进入 API 配置页面
2. 系统会自动检测并显示当前 API 连接异常
3. 点击警告区域中的 "添加新的 API 配置" 按钮
4. 填写新的 API 信息并测试连接
5. 测试成功后添加配置，系统会自动切换到新配置

### 场景 2：主动添加备用 API
1. 点击页面右上角的 "添加新配置" 按钮
2. 填写备用 API 的信息
3. 测试连接确保可用
4. 添加到配置列表中备用

### 场景 3：切换不同的 API 环境
1. 在配置列表中选择要使用的 API 配置
2. 点击对应配置的单选按钮
3. 系统会自动切换到选中的 API 配置

## 界面说明

### 页面顶部
- **标题区域**：显示页面名称和描述
- **状态指示器**：显示当前 API 连接状态
- **重新检测按钮**：手动重新检测当前 API 状态

### 异常警告区域（仅在 API 异常时显示）
- **红色警告框**：醒目显示当前 API 连接问题
- **错误详情**：显示具体的错误信息
- **快速添加按钮**：直接打开添加配置表单

### API 配置列表
- **配置卡片**：每个 API 配置显示为一个卡片
- **选择按钮**：单选按钮用于切换当前使用的配置
- **配置信息**：显示名称、地址、密钥状态
- **操作按钮**：测试连接、删除配置

### 添加配置表单
- **显示名称**：可选，用于标识不同的配置
- **API 地址**：必填，完整的 Clash API 地址
- **密钥**：可选，API 访问密钥
- **测试按钮**：验证配置是否可用
- **添加按钮**：保存配置到列表

## 配置示例

### 本地 Clash 配置
```
显示名称: 本地 Clash
API 地址: http://127.0.0.1:9090
密钥: (留空或填写实际密钥)
```

### 远程 Clash 配置
```
显示名称: 服务器 Clash
API 地址: http://192.168.1.100:9090
密钥: your-secret-key
```

### 自定义端口配置
```
显示名称: 自定义端口
API 地址: http://localhost:8080
密钥: custom-secret
```

## 注意事项

### ⚠️ 重要提醒
- 第一个配置是默认配置，无法删除
- 建议在添加配置前先测试连接
- 密钥信息会被安全存储，界面上只显示掩码
- 切换配置后，所有页面的数据会自动刷新

### 🔒 安全建议
- 不要在不安全的网络环境中使用明文密钥
- 定期检查和更新 API 密钥
- 删除不再使用的配置以减少安全风险

### 🐛 故障排除
1. **连接测试失败**：
   - 检查 API 地址是否正确
   - 确认 Clash 服务是否正在运行
   - 验证密钥是否正确

2. **页面显示异常**：
   - 刷新页面重新加载
   - 检查浏览器控制台错误信息
   - 确认网络连接正常

3. **配置切换无效**：
   - 等待几秒钟让系统完成切换
   - 手动刷新页面
   - 检查新配置是否可用

## 技术特性

- **实时状态检测**：自动监控 API 连接状态
- **智能缓存管理**：配置切换时自动清理缓存
- **错误处理**：完善的错误提示和恢复机制
- **响应式设计**：支持桌面和移动设备
- **暗色主题**：支持浅色/暗色主题切换

## 更新日志

### v2.0.0
- ✅ 新增 API 配置管理页面
- ✅ 支持多 API 配置切换
- ✅ 自动检测 API 连接状态
- ✅ 内置连接测试功能
- ✅ 智能缓存失效机制 