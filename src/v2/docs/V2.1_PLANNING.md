# Clash YACD UI - V2.1 ç‰ˆæœ¬è§„åˆ’

## ğŸ“‹ ç‰ˆæœ¬æ¦‚è¿°

V2.1 ç‰ˆæœ¬å°†åœ¨ V2.0 ç¨³å®šç‰ˆçš„åŸºç¡€ä¸Šï¼Œä¸“æ³¨äºä¼˜åŒ–ç”¨æˆ·äº¤äº’ä½“éªŒï¼Œç¡®ä¿ä¸ V1 ç‰ˆæœ¬åŠŸèƒ½å®Œå…¨å¯¹é½ã€‚æœ¬ç‰ˆæœ¬é‡ç‚¹å…³æ³¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–** - æ”¹è¿›äº¤äº’æµç¨‹ï¼Œæå‡è§†è§‰ä½“éªŒ
2. **åŠŸèƒ½å¯¹é½** - ç¡®ä¿ V2 ç‰ˆæœ¬åŒ…å« V1 çš„å…¨éƒ¨åŠŸèƒ½
3. **æ€§èƒ½ä¼˜åŒ–** - æå‡åŠ è½½é€Ÿåº¦å’Œè¿è¡Œæ•ˆç‡
4. **ç¨³å®šæ€§å¢å¼º** - ä¿®å¤é—®é¢˜ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§

## ğŸ¯ åŠŸèƒ½è§„åˆ’

### 1ï¸âƒ£ ç”¨æˆ·ä½“éªŒä¼˜åŒ– (ä¼˜å…ˆçº§ï¼šé«˜)

#### ä»»åŠ¡åˆ†è§£
- [ ] **1.1 äº¤äº’æµç¨‹ä¼˜åŒ–**
  - [ ] ç®€åŒ–å¸¸ç”¨æ“ä½œè·¯å¾„
  - [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ
  - [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯æ‰‹åŠ¿
  - [ ] æå‡è¡¨å•äº¤äº’ä½“éªŒ

- [ ] **1.2 è§†è§‰ä½“éªŒæå‡**
  - [ ] åŠ¨ç”»æ•ˆæœä¼˜åŒ–
  - [ ] ä¸»é¢˜è‰²å½©ç³»ç»Ÿå®Œå–„
  - [ ] æ·±è‰²æ¨¡å¼ç»†èŠ‚ä¼˜åŒ–
  - [ ] å›¾æ ‡ä¸æ’å›¾ç³»ç»Ÿç»Ÿä¸€

- [ ] **1.3 åé¦ˆæœºåˆ¶å¢å¼º**
  - [ ] æ“ä½œç»“æœå³æ—¶åé¦ˆ
  - [ ] åŠ è½½çŠ¶æ€ä¼˜åŒ–
  - [ ] é”™è¯¯æç¤ºå‹å¥½åŒ–
  - [ ] æˆåŠŸçŠ¶æ€æ˜ç¡®å±•ç¤º

- [ ] **1.4 å¯è®¿é—®æ€§æ”¹è¿›**
  - [ ] é”®ç›˜å¯¼èˆªæ”¯æŒ
  - [ ] å±å¹•é˜…è¯»å™¨å…¼å®¹
  - [ ] å¯¹æ¯”åº¦ä¼˜åŒ–
  - [ ] æ–‡å­—å¤§å°è°ƒæ•´æ”¯æŒ

#### æŠ€æœ¯è¦ç‚¹
```typescript
// å¿«æ·é”®æ”¯æŒç¤ºä¾‹
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    // æŒ‰ 'r' åˆ·æ–°ä»£ç†
    if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {
      refetchProxies();
    }
    
    // æŒ‰ 'f' èšç„¦æœç´¢æ¡†
    if (e.key === 'f' && !e.ctrlKey && !e.metaKey) {
      searchInputRef.current?.focus();
    }
  };
  
  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, [refetchProxies]);

// åŠ¨ç”»æ•ˆæœç¤ºä¾‹
const variants = {
  hidden: { opacity: 0, y: 20 },
  visible: { opacity: 1, y: 0 },
};

return (
  <motion.div
    initial="hidden"
    animate="visible"
    variants={variants}
    transition={{ duration: 0.3 }}
    className="card"
  >
    {children}
  </motion.div>
);
```

### 2ï¸âƒ£ åŠŸèƒ½å¯¹é½ (ä¼˜å…ˆçº§ï¼šé«˜)

#### ä»»åŠ¡åˆ†è§£
- [ ] **2.1 è§„åˆ™ç®¡ç†å¢å¼º**
  - [ ] è§„åˆ™æœç´¢ä¼˜åŒ–
  - [ ] è§„åˆ™åˆ†ç»„å±•ç¤º
  - [ ] è§„åˆ™æä¾›è€…ç®¡ç†
  - [ ] è§„åˆ™ç»Ÿè®¡å±•ç¤º

- [ ] **2.2 ä»£ç†åŠŸèƒ½å®Œå–„**
  - [ ] æ‰¹é‡å»¶è¿Ÿæµ‹è¯•
  - [ ] ä»£ç†åˆ†ç»„æŠ˜å è®°å¿†
  - [ ] ä»£ç†æ’åºåŠŸèƒ½
  - [ ] ä»£ç†æœç´¢å¢å¼º

- [ ] **2.3 è¿æ¥ç®¡ç†å¢å¼º**
  - [ ] è¿æ¥è¯¦æƒ…å±•ç¤º
  - [ ] è¿æ¥ç­›é€‰ä¼˜åŒ–
  - [ ] è¿æ¥ç»Ÿè®¡å›¾è¡¨
  - [ ] è¿æ¥å…³é—­ç¡®è®¤

- [ ] **2.4 é…ç½®ç³»ç»Ÿå®Œå–„**
  - [ ] é…ç½®å¯¼å…¥/å¯¼å‡º
  - [ ] é…ç½®å†å²è®°å½•
  - [ ] é…ç½®å¤‡ä»½è¿˜åŸ
  - [ ] é…ç½®éªŒè¯åŠŸèƒ½

#### æŠ€æœ¯è¦ç‚¹
```typescript
// è§„åˆ™æœç´¢ä¼˜åŒ–ç¤ºä¾‹
export function useRulesSearch(rules: Rule[], searchText: string) {
  return useMemo(() => {
    if (!searchText.trim()) return rules;
    
    const normalizedSearch = searchText.toLowerCase().trim();
    
    return rules.filter(rule => {
      return (
        rule.type.toLowerCase().includes(normalizedSearch) ||
        rule.payload.toLowerCase().includes(normalizedSearch) ||
        rule.proxy.toLowerCase().includes(normalizedSearch)
      );
    });
  }, [rules, searchText]);
}

// ä»£ç†åˆ†ç»„æŠ˜å è®°å¿†
useEffect(() => {
  // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æŠ˜å çŠ¶æ€
  const savedState = localStorage.getItem('proxy-groups-collapsed');
  if (savedState) {
    setCollapsedGroups(JSON.parse(savedState));
  }
}, []);

// ä¿å­˜æŠ˜å çŠ¶æ€
useEffect(() => {
  localStorage.setItem('proxy-groups-collapsed', JSON.stringify(collapsedGroups));
}, [collapsedGroups]);
```

### 3ï¸âƒ£ æ€§èƒ½ä¼˜åŒ– (ä¼˜å…ˆçº§ï¼šä¸­)

#### ä»»åŠ¡åˆ†è§£
- [ ] **3.1 åŠ è½½æ€§èƒ½ä¼˜åŒ–**
  - [ ] ä»£ç åˆ†å‰²ä¼˜åŒ–
  - [ ] èµ„æºé¢„åŠ è½½
  - [ ] æ‡’åŠ è½½ç­–ç•¥
  - [ ] å…³é”®è·¯å¾„æ¸²æŸ“ä¼˜å…ˆ

- [ ] **3.2 è¿è¡Œæ—¶æ€§èƒ½**
  - [ ] å‡å°‘ä¸å¿…è¦æ¸²æŸ“
  - [ ] åˆ—è¡¨è™šæ‹ŸåŒ–
  - [ ] äº‹ä»¶å¤„ç†ä¼˜åŒ–
  - [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–

- [ ] **3.3 ç½‘ç»œæ€§èƒ½**
  - [ ] API è¯·æ±‚åˆå¹¶
  - [ ] æ•°æ®ç¼“å­˜ç­–ç•¥
  - [ ] å¢é‡æ›´æ–°
  - [ ] è¯·æ±‚ä¼˜å…ˆçº§

#### æŠ€æœ¯è¦ç‚¹
```typescript
// è™šæ‹Ÿåˆ—è¡¨ç¤ºä¾‹
import { FixedSizeList } from 'react-window';

const ConnectionsList = ({ connections }) => {
  return (
    <FixedSizeList
      height={500}
      width="100%"
      itemCount={connections.length}
      itemSize={60}
    >
      {({ index, style }) => (
        <div style={style}>
          <ConnectionItem connection={connections[index]} />
        </div>
      )}
    </FixedSizeList>
  );
};

// å‡å°‘ä¸å¿…è¦æ¸²æŸ“
const MemoizedComponent = React.memo(({ value }) => {
  return <div>{value}</div>;
}, (prevProps, nextProps) => {
  // åªæœ‰å½“å€¼çœŸæ­£å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“
  return prevProps.value === nextProps.value;
});
```

### 4ï¸âƒ£ ç¨³å®šæ€§å¢å¼º (ä¼˜å…ˆçº§ï¼šé«˜)

#### ä»»åŠ¡åˆ†è§£
- [ ] **4.1 é”™è¯¯å¤„ç†**
  - [ ] API é”™è¯¯å¤„ç†å¢å¼º
  - [ ] å…¨å±€é”™è¯¯è¾¹ç•Œ
  - [ ] ç¦»çº¿çŠ¶æ€å¤„ç†
  - [ ] é‡è¯•æœºåˆ¶ä¼˜åŒ–

- [ ] **4.2 å…¼å®¹æ€§ä¿éšœ**
  - [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•
  - [ ] ç§»åŠ¨è®¾å¤‡é€‚é…
  - [ ] ä¸åŒ Clash ç‰ˆæœ¬å…¼å®¹
  - [ ] å±å¹•å°ºå¯¸è‡ªé€‚åº”

- [ ] **4.3 æ•°æ®ä¸€è‡´æ€§**
  - [ ] çŠ¶æ€åŒæ­¥æœºåˆ¶
  - [ ] ä¹è§‚æ›´æ–°å¤„ç†
  - [ ] æ•°æ®éªŒè¯
  - [ ] å†²çªè§£å†³ç­–ç•¥

#### æŠ€æœ¯è¦ç‚¹
```typescript
// å¢å¼ºçš„é”™è¯¯å¤„ç†
export function useApiWithErrorHandling<T>(
  queryKey: string,
  queryFn: () => Promise<T>,
  options?: UseQueryOptions<T>
) {
  const toast = useToast();
  
  return useQuery<T, Error>(queryKey, queryFn, {
    ...options,
    retry: (failureCount, error) => {
      // æŸäº›é”™è¯¯ä¸é‡è¯•
      if (error.message.includes('404')) return false;
      // æœ€å¤šé‡è¯• 3 æ¬¡
      return failureCount < 3;
    },
    onError: (error) => {
      toast({
        title: 'è¯·æ±‚å¤±è´¥',
        description: error.message,
        status: 'error',
        duration: 5000,
      });
      options?.onError?.(error);
    },
  });
}

// å…¨å±€é”™è¯¯è¾¹ç•Œ
export class GlobalErrorBoundary extends React.Component {
  state = { hasError: false, error: null };
  
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  
  componentDidCatch(error, info) {
    // è®°å½•é”™è¯¯
    console.error('å…¨å±€é”™è¯¯:', error, info);
    
    // å¯ä»¥å‘é€åˆ°é”™è¯¯è¿½è¸ªæœåŠ¡
    // errorTrackingService.captureException(error);
  }
  
  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }
    
    return this.props.children;
  }
}
```

## ğŸ“… å¼€å‘è®¡åˆ’

### é˜¶æ®µ 1: ç”¨æˆ·ä½“éªŒä¼˜åŒ– (3å‘¨)
- äº¤äº’æµç¨‹ä¼˜åŒ–
- è§†è§‰ä½“éªŒæå‡
- åé¦ˆæœºåˆ¶å¢å¼º
- å¯è®¿é—®æ€§æ”¹è¿›

### é˜¶æ®µ 2: åŠŸèƒ½å¯¹é½ (4å‘¨)
- è§„åˆ™ç®¡ç†å¢å¼º
- ä»£ç†åŠŸèƒ½å®Œå–„
- è¿æ¥ç®¡ç†å¢å¼º
- é…ç½®ç³»ç»Ÿå®Œå–„

### é˜¶æ®µ 3: æ€§èƒ½ä¸ç¨³å®šæ€§ (3å‘¨)
- åŠ è½½æ€§èƒ½ä¼˜åŒ–
- è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–
- é”™è¯¯å¤„ç†å¢å¼º
- å…¼å®¹æ€§ä¿éšœ

### é˜¶æ®µ 4: æµ‹è¯•ä¸å‘å¸ƒ (2å‘¨)
- å…¨é¢åŠŸèƒ½æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- å…¼å®¹æ€§æµ‹è¯•
- æ–‡æ¡£å®Œå–„ä¸å‘å¸ƒ

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### åŠŸèƒ½æµ‹è¯•
- V1/V2 åŠŸèƒ½å¯¹æ¯”æµ‹è¯•
- å…¨åŠŸèƒ½ç‚¹è¦†ç›–æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶æµ‹è¯•
- é”™è¯¯åœºæ™¯æµ‹è¯•

### æ€§èƒ½æµ‹è¯•
- åŠ è½½æ—¶é—´æµ‹è¯•
- å¤§æ•°æ®é›†æ€§èƒ½æµ‹è¯•
- å†…å­˜ä½¿ç”¨ç›‘æ§
- é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•

### å…¼å®¹æ€§æµ‹è¯•
- ä¸»æµæµè§ˆå™¨æµ‹è¯•
- ç§»åŠ¨è®¾å¤‡é€‚é…æµ‹è¯•
- ä¸åŒ Clash ç‰ˆæœ¬å…¼å®¹æ€§æµ‹è¯•
- ä¸åŒç½‘ç»œç¯å¢ƒæµ‹è¯•

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### æŠ€æœ¯æŒ‡æ ‡
- **é¦–å±åŠ è½½æ—¶é—´**: < 1ç§’
- **äº¤äº’åˆ°ç»˜åˆ¶æ—¶é—´**: < 100ms
- **å†…å­˜å ç”¨**: ä¼˜äº V1 ç‰ˆæœ¬
- **ä»£ç è´¨é‡**: 0 TypeScript é”™è¯¯

### ç”¨æˆ·æŒ‡æ ‡
- **åŠŸèƒ½å®Œæ•´åº¦**: 100% å¯¹é½ V1 åŠŸèƒ½
- **ç”¨æˆ·æ»¡æ„åº¦**: > 4.5/5
- **ä»»åŠ¡å®Œæˆæ—¶é—´**: æ¯” V1 å‡å°‘ 20%
- **é”™è¯¯ç‡**: < 1%

## ğŸ› ï¸ æŠ€æœ¯æ ˆå¢å¼º

### ç°æœ‰æŠ€æœ¯ä¼˜åŒ–
- **React 18 ç‰¹æ€§å……åˆ†åˆ©ç”¨**
- **TypeScript ç±»å‹ç³»ç»Ÿå¢å¼º**
- **Tailwind CSS æœ€ä½³å®è·µ**
- **React Query é«˜çº§åŠŸèƒ½**

### æ–°å¢å·¥å…·
- **React Window** - è™šæ‹Ÿåˆ—è¡¨
- **Framer Motion** - åŠ¨ç”»æ•ˆæœ
- **React Hook Form** - è¡¨å•å¤„ç†
- **Zod** - æ•°æ®éªŒè¯

## ğŸ“ æ³¨æ„äº‹é¡¹

### å‘åå…¼å®¹
- ç¡®ä¿ä¸ç°æœ‰é…ç½®æ–‡ä»¶å…¼å®¹
- ä¿æŒ API æ¥å£ç¨³å®š
- æä¾›åŠŸèƒ½é™çº§æ–¹æ¡ˆ

### å¼€å‘è§„èŒƒ
- ä¸¥æ ¼éµå¾ª V2 æ¶æ„è§„èŒƒ
- ä¿æŒä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
- å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

### å‘å¸ƒç­–ç•¥
- ç°åº¦å‘å¸ƒè®¡åˆ’
- åŠŸèƒ½å¼€å…³æœºåˆ¶
- å›æ»šæ–¹æ¡ˆ

## ğŸ”„ æœ€è¿‘æ›´æ–°

### 2024å¹´6æœˆ16æ—¥
- âœ… å®Œæˆ V2.1 è§„åˆ’è°ƒæ•´
  - ç§»é™¤ PWA åŠŸèƒ½
  - ä¸“æ³¨äºç”¨æˆ·äº¤äº’ä½“éªŒä¼˜åŒ–
  - ç¡®ä¿ä¸ V1 ç‰ˆæœ¬åŠŸèƒ½å¯¹é½
  - å¢å¼ºç³»ç»Ÿç¨³å®šæ€§

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.2  
**åˆ›å»ºæ—¥æœŸ**: 2024å¹´6æœˆ16æ—¥  
**æœ€åæ›´æ–°**: 2024å¹´6æœˆ16æ—¥ 