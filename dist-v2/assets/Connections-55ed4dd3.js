import{b as F,r as x,h as T,i as I,j as e}from"./index.v2-91df2e0b.js";import{C as d,b as o,B as h}from"./Card-47838b8a.js";import{F as U}from"./VirtualList-d0835ed9.js";const K=()=>{var N,w,k,b,y,C;const{data:t,isLoading:M,error:f,refetch:g}=F(),[n,L]=x.useState(""),[i,B]=x.useState("all"),[V,z]=x.useState(new Set),p=T(),m=I(),j=x.useMemo(()=>t!=null&&t.connections?t.connections.filter(r=>{const c=n===""||r.metadata.host&&r.metadata.host.toLowerCase().includes(n.toLowerCase())||r.metadata.destinationIP.includes(n)||r.chains.some(a=>a.toLowerCase().includes(n.toLowerCase())),l=i==="all"||r.metadata.network.toLowerCase()===i.toLowerCase();return c&&l}):[],[t==null?void 0:t.connections,n,i]),W=async s=>{try{await p.mutateAsync(s)}catch(r){console.error("关闭连接失败:",r)}},P=async()=>{try{await m.mutateAsync(),z(new Set)}catch(s){console.error("关闭所有连接失败:",s)}};if(M)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-theme hidden lg:block",children:"连接"}),e.jsx(d,{children:e.jsx(o,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"})]})})})]});if(f)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-theme hidden lg:block",children:"连接"}),e.jsx(d,{children:e.jsx(o,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-medium text-theme mb-2",children:"加载失败"}),e.jsx("p",{className:"text-theme-secondary mb-4",children:String(f)}),e.jsx(h,{onClick:()=>g(),children:"重试"})]})})})]});const u=((N=t==null?void 0:t.connections)==null?void 0:N.length)||0,S=((k=(w=t==null?void 0:t.connections)==null?void 0:w.filter(s=>s.metadata.network==="tcp"))==null?void 0:k.length)||0,$=((y=(b=t==null?void 0:t.connections)==null?void 0:b.filter(s=>s.metadata.network==="udp"))==null?void 0:y.length)||0,A=((C=t==null?void 0:t.connections)==null?void 0:C.reduce((s,r)=>s+r.upload+r.download,0))||0,v=s=>{if(s===0)return"0 B";const r=1024,c=["B","KB","MB","GB"],l=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,l)).toFixed(2))+" "+c[l]},H=s=>{const r=new Date(s),l=new Date().getTime()-r.getTime(),a=Math.floor(l/1e3);return a<60?`${a}s`:a<3600?`${Math.floor(a/60)}m ${a%60}s`:`${Math.floor(a/3600)}h ${Math.floor(a%3600/60)}m`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-4 px-6 bg-gradient-to-r from-slate-500/10 to-stone-500/10 dark:from-slate-500/20 dark:to-stone-500/20 rounded-lg border border-slate-300/50 dark:border-slate-600/50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-slate-600 to-stone-700 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-theme hidden lg:block",children:"连接"}),e.jsxs("p",{className:"text-sm text-theme-secondary",children:["实时网络连接监控 • 共 ",u," 个连接"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[u>0&&e.jsxs(h,{variant:"outline",size:"sm",onClick:P,disabled:m.isLoading,className:"text-sm text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),m.isLoading?"关闭中...":"关闭所有"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>g(),className:"text-sm",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"刷新"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(d,{className:"overflow-hidden border-0 shadow-lg card-hover",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-slate-700 dark:text-slate-300",children:u}),e.jsx("div",{className:"text-xs text-theme-secondary font-medium",children:"总连接数"})]})]})})}),e.jsx(d,{className:"overflow-hidden border-0 shadow-lg card-hover",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-zinc-600 to-zinc-700 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-zinc-700 dark:text-zinc-300",children:S}),e.jsx("div",{className:"text-xs text-theme-secondary font-medium",children:"TCP 连接"})]})]})})}),e.jsx(d,{className:"overflow-hidden border-0 shadow-lg card-hover",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-stone-600 to-stone-700 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-stone-700 dark:text-stone-300",children:$}),e.jsx("div",{className:"text-xs text-theme-secondary font-medium",children:"UDP 连接"})]})]})})}),e.jsx(d,{className:"overflow-hidden border-0 shadow-lg card-hover",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-neutral-600 to-neutral-700 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-neutral-700 dark:text-neutral-300",children:v(A)}),e.jsx("div",{className:"text-xs text-theme-secondary font-medium",children:"总流量"})]})]})})})]}),e.jsx(d,{className:"overflow-hidden border-0 shadow-lg card-hover",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"搜索主机名、IP地址或代理链...",value:n,onChange:s=>L(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-theme rounded-lg bg-surface text-theme focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-colors"})]}),e.jsx("div",{children:e.jsxs("select",{value:i,onChange:s=>B(s.target.value),className:"px-3 py-2 border border-theme rounded-lg bg-surface text-theme focus:ring-2 focus:ring-slate-500 focus:border-slate-500 transition-colors",children:[e.jsx("option",{value:"all",children:"所有协议"}),e.jsx("option",{value:"tcp",children:"TCP"}),e.jsx("option",{value:"udp",children:"UDP"})]})})]})})}),e.jsx(d,{className:"overflow-hidden border-0 shadow-lg",children:e.jsx(o,{className:"p-4",children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-6 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"})})}),e.jsx("h3",{className:"text-xl font-semibold text-theme mb-3",children:n||i!=="all"?"没有找到匹配的连接":"暂无活跃连接"}),e.jsx("p",{className:"text-theme-secondary max-w-md mx-auto",children:n||i!=="all"?"尝试调整搜索条件或筛选器":"当前没有活跃的网络连接"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-theme-secondary pb-2 border-b border-theme",children:[e.jsxs("span",{children:["显示 ",j.length," 个连接"]}),e.jsx("span",{children:"实时更新"})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto custom-scrollbar",children:e.jsx(U,{items:j,height:384,itemHeight:120,renderItem:(s,r)=>{var l,a;const c=s.metadata.host||`${s.metadata.destinationIP}:${s.metadata.destinationPort}`;return e.jsx("div",{className:"border border-theme rounded-lg p-3 m-2 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s.metadata.network==="tcp"?"bg-blue-500":s.metadata.network==="udp"?"bg-green-500":"bg-gray-500"}`}),e.jsx("span",{className:"text-sm font-medium text-theme truncate",children:c}),e.jsx("span",{className:"text-xs px-2 py-1 bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-full",children:(l=s.metadata.network)==null?void 0:l.toUpperCase()})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-theme-secondary",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"代理链:"}),e.jsx("div",{className:"truncate text-theme-secondary",children:((a=s.chains)==null?void 0:a.join(" → "))||"Direct"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"规则:"}),e.jsx("div",{className:"truncate text-theme-secondary",children:s.rule||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"流量:"}),e.jsxs("div",{className:"text-theme-secondary",children:["↑",v(s.upload)," ↓",v(s.download)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"持续时间:"}),e.jsx("div",{className:"text-theme-secondary",children:H(s.start)})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 ml-4",children:e.jsx(h,{variant:"outline",size:"sm",onClick:()=>W(s.id),disabled:p.isLoading,className:"text-xs px-2 py-1 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})},s.id||r)},className:"space-y-0"})})]})})})]})};export{K as Connections};
