import{n as w,o as A,r as g,j as e,S as C}from"./index.v2-6f2945c0.js";import{B as b,C as y,b as v,a as k}from"./Card-4086e66d.js";const L=({config:x,index:i,isSelected:s,onSelect:r,onDelete:h,onEdit:p,onTest:t})=>{const[c,m]=g.useState(!1),[d,a]=g.useState(null),f=async()=>{m(!0);try{const u=await t();a(u)}catch(u){a({success:!1,message:"测试失败",error:u instanceof Error?u.message:"未知错误"})}finally{m(!1)}},n=u=>{try{const j=new URL(u);return`${j.protocol}//${j.host}`}catch{return u}};return e.jsx(y,{className:`transition-all ${s?"ring-2 ring-blue-500":""}`,children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",checked:s,onChange:r,className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[x.metaLabel||`API ${i+1}`,s&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full",children:"当前使用"})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono",children:n(x.baseURL)}),x.secret&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:"密钥: ••••••••"})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[d&&e.jsx(C,{status:d.success?"success":"error",label:d.success?"连接正常":"连接失败"}),e.jsx(b,{variant:"outline",size:"sm",onClick:f,disabled:c,children:c?"测试中...":"测试"}),e.jsx(b,{variant:"outline",size:"sm",onClick:p,className:"text-blue-600 hover:text-blue-700",children:"编辑"}),i>0&&e.jsx(b,{variant:"outline",size:"sm",onClick:h,className:"text-red-600 hover:text-red-700",children:"删除"})]})]}),d&&!d.success&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-sm text-red-600 dark:text-red-400",children:[d.message,d.error&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:d.error})]}),d&&d.success&&d.version&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded text-sm text-green-600 dark:text-green-400",children:["连接成功！Clash 版本: ",d.version]})]})})},I=({onAdd:x,onCancel:i})=>{const[s,r]=g.useState({baseURL:"http://10.8.87.121:9090",secret:"",metaLabel:""}),[h,p]=g.useState(!1),[t,c]=g.useState(null),m=async()=>{p(!0),c(null);try{const a=await fetch(`${s.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...s.secret&&{Authorization:`Bearer ${s.secret}`}}});if(a.ok){const f=await a.json();c({success:!0,message:"连接成功",version:f.version||"Unknown"})}else c({success:!1,message:`HTTP ${a.status}: ${a.statusText}`})}catch(a){c({success:!1,message:"连接失败",error:a instanceof Error?a.message:"网络错误"})}finally{p(!1)}},d=a=>{if(a.preventDefault(),!s.baseURL.trim())return;const f={baseURL:s.baseURL.trim(),secret:s.secret.trim()||void 0,metaLabel:s.metaLabel.trim()||void 0,addedAt:Date.now()};x(f)};return e.jsxs(y,{children:[e.jsxs(k,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"添加新的 API 配置"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"配置新的 Clash API 连接"})]}),e.jsx(v,{children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"metaLabel",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"显示名称 (可选)"}),e.jsx("input",{id:"metaLabel",type:"text",value:s.metaLabel,onChange:a=>r({...s,metaLabel:a.target.value}),placeholder:"例如: 本地 Clash",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"baseURL",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"API 地址 *"}),e.jsx("input",{id:"baseURL",type:"url",value:s.baseURL,onChange:a=>r({...s,baseURL:a.target.value}),placeholder:"http://10.8.87.121:9090",required:!0,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Clash API 的完整地址，包括协议和端口"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"secret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"密钥 (可选)"}),e.jsx("input",{id:"secret",type:"password",value:s.secret,onChange:a=>r({...s,secret:a.target.value}),placeholder:"API 访问密钥",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:m,disabled:h||!s.baseURL.trim(),children:h?"测试中...":"测试连接"}),e.jsx(b,{type:"submit",disabled:!s.baseURL.trim()||t&&!t.success,children:"添加配置"}),e.jsx(b,{type:"button",variant:"outline",onClick:i,children:"取消"})]}),t&&e.jsxs("div",{className:`p-3 rounded-md ${t.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"}`,children:[e.jsx("div",{className:"font-medium",children:t.message}),t.version&&e.jsxs("div",{className:"text-sm mt-1",children:["Clash 版本: ",t.version]}),t.error&&e.jsx("div",{className:"text-sm mt-1 opacity-75",children:t.error})]})]})})]})},P=({config:x,onSave:i,onCancel:s})=>{const[r,h]=g.useState({baseURL:x.baseURL||"http://10.8.87.121:9090",secret:x.secret||"",metaLabel:x.metaLabel||""}),[p,t]=g.useState(!1),[c,m]=g.useState(null),d=(n,u)=>{h(j=>({...j,[n]:u})),(n==="baseURL"||n==="secret")&&m(null)},a=async()=>{if(!r.baseURL.trim()){m({success:!1,message:"请输入有效的API地址"});return}t(!0),m(null);try{const n=await fetch(`${r.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...r.secret&&{Authorization:`Bearer ${r.secret}`}},signal:AbortSignal.timeout(1e4)});if(n.ok){const u=await n.json();m({success:!0,message:"连接成功",version:u.version||"Unknown"})}else m({success:!1,message:`HTTP ${n.status}: ${n.statusText}`})}catch(n){m({success:!1,message:"连接失败",error:n instanceof Error?n.message:"网络错误"})}finally{t(!1)}},f=n=>{if(n.preventDefault(),!r.baseURL.trim())return;const u={...x,baseURL:r.baseURL.trim(),secret:r.secret.trim()||void 0,metaLabel:r.metaLabel.trim()||void 0};i(u)};return e.jsxs(y,{children:[e.jsxs(k,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"编辑 API 配置"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"修改当前 API 连接设置"})]}),e.jsx(v,{children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"editMetaLabel",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"显示名称 (可选)"}),e.jsx("input",{id:"editMetaLabel",type:"text",value:r.metaLabel,onChange:n=>d("metaLabel",n.target.value),placeholder:"例如: 本地 Clash",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"editBaseURL",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"API 地址 *"}),e.jsx("input",{id:"editBaseURL",type:"url",required:!0,value:r.baseURL,onChange:n=>d("baseURL",n.target.value),placeholder:"http://10.8.87.121:9090",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Clash API 的完整地址，包括协议和端口"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"editSecret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"密钥 (可选)"}),e.jsx("input",{id:"editSecret",type:"password",value:r.secret,onChange:n=>d("secret",n.target.value),placeholder:"API 访问密钥",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),c&&e.jsx("div",{className:`p-3 rounded-md ${c.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:c.message}),c.version&&e.jsxs("p",{className:"text-sm mt-1",children:["Clash 版本: ",c.version]}),c.error&&e.jsx("p",{className:"text-sm mt-1 opacity-75",children:c.error})]}),!c.success&&e.jsx("button",{type:"button",onClick:()=>m(null),className:"ml-2 text-red-500 hover:text-red-700 p-1",title:"清除测试结果",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:a,disabled:p||!r.baseURL.trim(),children:p?"测试中...":c?"重新测试":"测试连接"}),e.jsx(b,{type:"submit",disabled:!r.baseURL.trim(),children:"保存修改"}),e.jsx(b,{type:"button",variant:"outline",onClick:s,children:"取消"})]})]})})]})},S=()=>{const x=w(),i=A(),[s,r]=g.useState(!1),[h,p]=g.useState(null),[t,c]=g.useState(null),[m,d]=g.useState(!1),a=async()=>{d(!0);try{const l=await fetch(`${x.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...x.secret&&{Authorization:`Bearer ${x.secret}`}}});if(l.ok){const o=await l.json();c({success:!0,message:"当前 API 连接正常",version:o.version||"Unknown"})}else c({success:!1,message:`当前 API 连接失败: HTTP ${l.status}`})}catch(l){c({success:!1,message:"当前 API 无法连接",error:l instanceof Error?l.message:"网络错误"})}finally{d(!1)}};g.useEffect(()=>{a()},[x.baseURL,x.secret]);const f=async l=>{try{const o=await fetch(`${l.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...l.secret&&{Authorization:`Bearer ${l.secret}`}}});return o.ok?{success:!0,message:"连接成功",version:(await o.json()).version||"Unknown"}:{success:!1,message:`HTTP ${o.status}: ${o.statusText}`}}catch(o){return{success:!1,message:"连接失败",error:o instanceof Error?o.message:"网络错误"}}},n=l=>{const o=i.addConfig(l);r(!1),t&&!t.success&&i.switchConfig(o)},u=l=>{i.removeConfig(l)},j=l=>{r(!1),p(l)},N=()=>{p(null),r(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"API 配置管理"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"管理 Clash API 连接配置"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{variant:"outline",onClick:a,disabled:m,children:m?"检测中...":"重新检测"}),t&&e.jsx(C,{status:t.success?"success":"error",label:t.success?"当前 API 正常":"当前 API 异常"})]})]}),t&&!t.success&&e.jsx(y,{className:"border-red-200 dark:border-red-800",children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-red-800 dark:text-red-200",children:"当前 API 连接异常"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:t.message}),t.error&&e.jsx("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:t.error}),e.jsxs("div",{className:"mt-3 flex space-x-2",children:[e.jsx(b,{size:"sm",onClick:N,disabled:s||h!==null,children:"添加新的 API 配置"}),i.selectedIndex>=0&&e.jsx(b,{size:"sm",variant:"outline",onClick:()=>j(i.selectedIndex),disabled:h!==null||s,children:"编辑当前配置"})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["已配置的 API (",i.configs.length,")"]}),!s&&h===null&&e.jsx(b,{onClick:N,children:"添加新配置"})]}),i.configs.map((l,o)=>e.jsx(L,{config:l,index:o,isSelected:o===i.selectedIndex,onSelect:()=>i.switchConfig(o),onDelete:()=>u(o),onEdit:()=>j(o),onTest:()=>f(l)},`${l.baseURL}-${l.addedAt||o}`))]}),s&&e.jsx(I,{onAdd:n,onCancel:()=>r(!1)}),h!==null&&e.jsx(P,{config:i.configs[h],onSave:l=>{i.updateConfig(h,l),p(null)},onCancel:()=>p(null)}),e.jsxs(y,{children:[e.jsx(k,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"使用说明"})}),e.jsxs(v,{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{children:"• 系统会自动检测当前 API 的连接状态"}),e.jsx("p",{children:"• 当检测到 API 连接异常时，建议添加新的 API 配置"}),e.jsx("p",{children:"• 可以添加多个 API 配置，并在它们之间切换"}),e.jsx("p",{children:"• 第一个配置是默认配置，无法删除"}),e.jsx("p",{children:"• 建议在添加配置前先测试连接"})]})]})]})};export{S as APIConfig};
