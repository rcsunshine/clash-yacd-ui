import{j as e,k as X,n as Y,r,L as Z}from"./index.v2-1cf93f6a.js";import{C as w,B as l}from"./Card-380ba006.js";const M=({className:o,type:h="text",...i})=>e.jsx("input",{type:h,className:X("flex h-10 w-full rounded-md border border-gray-300 dark:border-gray-600","bg-white dark:bg-gray-700 px-3 py-2 text-sm","text-gray-900 dark:text-white placeholder:text-gray-500 dark:placeholder:text-gray-400","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent","disabled:cursor-not-allowed disabled:opacity-50",o),...i}),se=()=>{const{configs:o,selectedIndex:h,currentConfig:i,addConfig:R,removeConfig:S,updateConfig:L,switchConfig:U}=Y(),[c,b]=r.useState({baseURL:"",secret:""}),[j,p]=r.useState(!1),[f,v]=r.useState(null),[y,G]=r.useState(!1),[T,A]=r.useState(!1),[d,k]=r.useState(null),[I,$]=r.useState(new Set),[m,E]=r.useState(new Map),[P,F]=r.useState(!1),[x,u]=r.useState(null),g=r.useCallback(async t=>{try{const s=new AbortController,n=setTimeout(()=>s.abort(),1e4),a=await fetch(`${t.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...t.secret&&{Authorization:`Bearer ${t.secret}`}},signal:s.signal});return clearTimeout(n),a.ok?{success:!0,message:"连接成功",version:(await a.json()).version||"Unknown"}:{success:!1,message:`HTTP ${a.status}: ${a.statusText}`}}catch(s){return s instanceof Error&&s.name==="AbortError"?{success:!1,message:"连接超时",error:"请求超时（10秒）"}:{success:!1,message:"连接失败",error:s instanceof Error?s.message:"网络错误"}}},[]),H=r.useCallback(async()=>{A(!0),k(null);try{const t=await g(i);k(t)}catch(t){k({success:!1,message:"测试失败",error:t instanceof Error?t.message:"未知错误"})}finally{A(!1)}},[i,g]),V=r.useCallback(async t=>{const s=o[t];if(s){$(n=>new Set([...n,t]));try{const n=await g(s);E(a=>new Map([...a,[t,n]]))}catch(n){E(a=>new Map([...a,[t,{success:!1,message:"测试失败",error:n instanceof Error?n.message:"未知错误"}]]))}finally{$(n=>{const a=new Set(n);return a.delete(t),a})}}},[o,g]),q=r.useCallback(async()=>{if(!c.baseURL.trim()){u({success:!1,message:"请输入API地址"});return}F(!0),u(null);const t={baseURL:c.baseURL.trim(),secret:c.secret.trim()};try{const s=await g(t);u(s)}catch(s){u({success:!1,message:"测试失败",error:s instanceof Error?s.message:"未知错误"})}finally{F(!1)}},[c,g]),J=r.useCallback(()=>{b({baseURL:"",secret:""}),p(!0),v(null),u(null)},[]),K=r.useCallback(t=>{const s=o[t];b({baseURL:s.baseURL,secret:s.secret}),p(!1),v(t),u(null)},[o]),C=r.useCallback(()=>{p(!1),v(null),b({baseURL:"",secret:""}),u(null)},[]),O=r.useCallback(()=>{if(!c.baseURL.trim()){alert("请输入API地址");return}const t={baseURL:c.baseURL.trim(),secret:c.secret.trim()};if(j){const s=R(t);console.log(`✅ 添加新配置成功，索引: ${s}`)}else f!==null&&L(f,t)&&console.log(`✅ 更新配置 ${f} 成功`);C()},[c,j,f,R,L,C]),Q=r.useCallback(t=>{if(t===0){alert("不能删除默认配置");return}confirm("确定要删除这个配置吗？")&&S(t)&&console.log(`✅ 删除配置 ${t} 成功`)},[S]),W=r.useCallback(t=>{U(t)&&console.log(`✅ 切换到配置 ${t} 成功`)},[U]);return i?e.jsx("div",{className:"page-wrapper api-config-page",children:e.jsx("div",{className:"page-body",children:e.jsx("div",{className:"container-fluid px-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"API 配置管理"}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"管理 Clash API 连接配置"})]}),e.jsx(w,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"当前配置"}),e.jsx(l,{variant:"outline",onClick:H,disabled:T,children:T?"测试中...":"测试连接"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentBaseURL",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API 地址"}),e.jsx("p",{id:"currentBaseURL",className:"text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 px-3 py-2 rounded border",children:i.baseURL})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentSecret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Secret"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{id:"currentSecret",className:"flex-1 text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 px-3 py-2 rounded border",children:i.secret?y?i.secret:"••••••••••••":"(未设置)"}),i.secret&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>G(!y),className:"px-2 py-1 text-xs",children:y?"隐藏":"显示"})]})]})]})]})}),e.jsx(w,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"配置列表"}),e.jsx(l,{variant:"primary",onClick:J,children:"添加配置"})]}),e.jsx("div",{className:"space-y-3",children:o.map((t,s)=>{var n,a,N,z,B,D;return e.jsxs("div",{className:`p-3 border rounded-lg ${s===h?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.baseURL}),t.secret&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Secret: ••••••••"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s===h&&e.jsx("span",{className:"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 px-2 py-1 rounded",children:"当前"}),s!==h&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>W(s),children:"切换"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>V(s),disabled:I.has(s),children:I.has(s)?"测试中...":"测试"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>K(s),children:"编辑"}),s!==0&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Q(s),className:"text-red-600 hover:text-red-700",children:"删除"})]})]}),m.has(s)&&e.jsxs("div",{className:`mt-2 p-2 rounded text-sm ${(n=m.get(s))!=null&&n.success?"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400"}`,children:[e.jsx("div",{className:"font-medium",children:(a=m.get(s))==null?void 0:a.message}),((N=m.get(s))==null?void 0:N.version)&&e.jsxs("div",{className:"text-xs mt-1",children:["版本: ",(z=m.get(s))==null?void 0:z.version]}),((B=m.get(s))==null?void 0:B.error)&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:(D=m.get(s))==null?void 0:D.error})]})]},s)})})]})}),(j||f!==null)&&e.jsx(w,{children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4",children:j?"添加新配置":"编辑配置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"baseURL",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"API 地址 *"}),e.jsx(M,{id:"baseURL",type:"text",placeholder:"http://127.0.0.1:9090",value:c.baseURL,onChange:t=>b(s=>({...s,baseURL:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"secret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Secret"}),e.jsx(M,{id:"secret",type:"password",placeholder:"留空表示无密码",value:c.secret,onChange:t=>b(s=>({...s,secret:t.target.value}))})]}),x&&e.jsxs("div",{className:`p-3 rounded-md ${x.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"}`,children:[e.jsx("div",{className:"font-medium",children:x.message}),x.version&&e.jsxs("div",{className:"text-sm mt-1",children:["Clash 版本: ",x.version]}),x.error&&e.jsx("div",{className:"text-sm mt-1 opacity-75",children:x.error})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(l,{variant:"outline",onClick:q,disabled:P||!c.baseURL.trim(),children:P?"测试中...":"测试连接"}),e.jsx(l,{variant:"primary",onClick:O,children:"保存"}),e.jsx(l,{variant:"outline",onClick:C,children:"取消"})]})]}),d&&e.jsxs("div",{className:`mt-4 p-3 rounded-md ${d.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"}`,children:[e.jsx("div",{className:"font-medium",children:d.message}),d.version&&e.jsxs("div",{className:"text-sm mt-1",children:["Clash 版本: ",d.version]}),d.error&&e.jsx("div",{className:"text-sm mt-1 opacity-75",children:d.error})]})]})})]})})})}):e.jsx(Z,{text:"正在加载API配置..."})};export{se as APIConfig};
