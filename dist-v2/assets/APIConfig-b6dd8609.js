import{c as L,n as U,r as u,j as e,S as I,o as T,p as S}from"./index.v2-7c3d67aa.js";import{B as h,C as y,b as v,a as C}from"./Card-631a1429.js";const $=({config:o,index:b,isSelected:t,onSelect:a,onDelete:p,onEdit:g,onTest:i})=>{const[n,x]=u.useState(!1),[s,l]=u.useState(null),f=async()=>{x(!0);try{const m=await i();l(m)}catch(m){l({success:!1,message:"测试失败",error:m instanceof Error?m.message:"未知错误"})}finally{x(!1)}},c=m=>{try{const j=new URL(m);return`${j.protocol}//${j.host}`}catch{return m}};return e.jsx(y,{className:`transition-all ${t?"ring-2 ring-blue-500":""}`,children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"radio",checked:t,onChange:a,className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:[o.metaLabel||`API ${b+1}`,t&&e.jsx("span",{className:"ml-2 text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full",children:"当前使用"})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono",children:c(o.baseURL)}),o.secret&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:"密钥: ••••••••"})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s&&e.jsx(I,{status:s.success?"success":"error",label:s.success?"连接正常":"连接失败"}),e.jsx(h,{variant:"outline",size:"sm",onClick:f,disabled:n,children:n?"测试中...":"测试"}),e.jsx(h,{variant:"outline",size:"sm",onClick:g,className:"text-blue-600 hover:text-blue-700",children:"编辑"}),b>0&&e.jsx(h,{variant:"outline",size:"sm",onClick:p,className:"text-red-600 hover:text-red-700",children:"删除"})]})]}),s&&!s.success&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded text-sm text-red-600 dark:text-red-400",children:[s.message,s.error&&e.jsx("div",{className:"text-xs mt-1 opacity-75",children:s.error})]}),s&&s.success&&s.version&&e.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 rounded text-sm text-green-600 dark:text-green-400",children:["连接成功！Clash 版本: ",s.version]})]})})},E=({onAdd:o,onCancel:b})=>{const[t,a]=u.useState({baseURL:"http://10.8.87.121:9090",secret:"",metaLabel:""}),[p,g]=u.useState(!1),[i,n]=u.useState(null),x=async()=>{g(!0),n(null);try{const l=await fetch(`${t.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...t.secret&&{Authorization:`Bearer ${t.secret}`}}});if(l.ok){const f=await l.json();n({success:!0,message:"连接成功",version:f.version||"Unknown"})}else n({success:!1,message:`HTTP ${l.status}: ${l.statusText}`})}catch(l){n({success:!1,message:"连接失败",error:l instanceof Error?l.message:"网络错误"})}finally{g(!1)}},s=l=>{if(l.preventDefault(),!t.baseURL.trim())return;const f={baseURL:t.baseURL.trim(),secret:t.secret.trim()||void 0,metaLabel:t.metaLabel.trim()||void 0,addedAt:Date.now()};o(f)};return e.jsxs(y,{children:[e.jsxs(C,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"添加新的 API 配置"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"配置新的 Clash API 连接"})]}),e.jsx(v,{children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"metaLabel",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"显示名称 (可选)"}),e.jsx("input",{id:"metaLabel",type:"text",value:t.metaLabel,onChange:l=>a({...t,metaLabel:l.target.value}),placeholder:"例如: 本地 Clash",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"baseURL",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"API 地址 *"}),e.jsx("input",{id:"baseURL",type:"url",value:t.baseURL,onChange:l=>a({...t,baseURL:l.target.value}),placeholder:"http://10.8.87.121:9090",required:!0,className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Clash API 的完整地址，包括协议和端口"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"secret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"密钥 (可选)"}),e.jsx("input",{id:"secret",type:"password",value:t.secret,onChange:l=>a({...t,secret:l.target.value}),placeholder:"API 访问密钥",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:x,disabled:p||!t.baseURL.trim(),children:p?"测试中...":"测试连接"}),e.jsx(h,{type:"submit",disabled:!t.baseURL.trim()||i&&!i.success,children:"添加配置"}),e.jsx(h,{type:"button",variant:"outline",onClick:b,children:"取消"})]}),i&&e.jsxs("div",{className:`p-3 rounded-md ${i.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300"}`,children:[e.jsx("div",{className:"font-medium",children:i.message}),i.version&&e.jsxs("div",{className:"text-sm mt-1",children:["Clash 版本: ",i.version]}),i.error&&e.jsx("div",{className:"text-sm mt-1 opacity-75",children:i.error})]})]})})]})},F=({config:o,onSave:b,onCancel:t})=>{const[a,p]=u.useState({baseURL:o.baseURL||"http://10.8.87.121:9090",secret:o.secret||"",metaLabel:o.metaLabel||""}),[g,i]=u.useState(!1),[n,x]=u.useState(null),s=(c,m)=>{p(j=>({...j,[c]:m})),(c==="baseURL"||c==="secret")&&x(null)},l=async()=>{if(!a.baseURL.trim()){x({success:!1,message:"请输入有效的API地址"});return}i(!0),x(null);try{const c=await fetch(`${a.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...a.secret&&{Authorization:`Bearer ${a.secret}`}},signal:AbortSignal.timeout(1e4)});if(c.ok){const m=await c.json();x({success:!0,message:"连接成功",version:m.version||"Unknown"})}else x({success:!1,message:`HTTP ${c.status}: ${c.statusText}`})}catch(c){x({success:!1,message:"连接失败",error:c instanceof Error?c.message:"网络错误"})}finally{i(!1)}},f=c=>{if(c.preventDefault(),!a.baseURL.trim())return;const m={...o,baseURL:a.baseURL.trim(),secret:a.secret.trim()||void 0,metaLabel:a.metaLabel.trim()||void 0};b(m)};return e.jsxs(y,{children:[e.jsxs(C,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"编辑 API 配置"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"修改当前 API 连接设置"})]}),e.jsx(v,{children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"editMetaLabel",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"显示名称 (可选)"}),e.jsx("input",{id:"editMetaLabel",type:"text",value:a.metaLabel,onChange:c=>s("metaLabel",c.target.value),placeholder:"例如: 本地 Clash",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"editBaseURL",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"API 地址 *"}),e.jsx("input",{id:"editBaseURL",type:"url",required:!0,value:a.baseURL,onChange:c=>s("baseURL",c.target.value),placeholder:"http://10.8.87.121:9090",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Clash API 的完整地址，包括协议和端口"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"editSecret",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"密钥 (可选)"}),e.jsx("input",{id:"editSecret",type:"password",value:a.secret,onChange:c=>s("secret",c.target.value),placeholder:"API 访问密钥",className:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md 
                       bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                       focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),n&&e.jsx("div",{className:`p-3 rounded-md ${n.success?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:n.message}),n.version&&e.jsxs("p",{className:"text-sm mt-1",children:["Clash 版本: ",n.version]}),n.error&&e.jsx("p",{className:"text-sm mt-1 opacity-75",children:n.error})]}),!n.success&&e.jsx("button",{type:"button",onClick:()=>x(null),className:"ml-2 text-red-500 hover:text-red-700 p-1",title:"清除测试结果",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:l,disabled:g||!a.baseURL.trim(),children:g?"测试中...":n?"重新测试":"测试连接"}),e.jsx(h,{type:"submit",disabled:!a.baseURL.trim(),children:"保存修改"}),e.jsx(h,{type:"button",variant:"outline",onClick:t,children:"取消"})]})]})})]})},B=()=>{const[o,b]=L(T),[t,a]=L(S),p=U(),[g,i]=u.useState(!1),[n,x]=u.useState(null),[s,l]=u.useState(null),[f,c]=u.useState(!1),m=async()=>{c(!0);try{const r=await fetch(`${p.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...p.secret&&{Authorization:`Bearer ${p.secret}`}}});if(r.ok){const d=await r.json();l({success:!0,message:"当前 API 连接正常",version:d.version||"Unknown"})}else l({success:!1,message:`当前 API 连接失败: HTTP ${r.status}`})}catch(r){l({success:!1,message:"当前 API 无法连接",error:r instanceof Error?r.message:"网络错误"})}finally{c(!1)}};u.useEffect(()=>{m()},[m]);const j=async r=>{try{const d=await fetch(`${r.baseURL}/version`,{method:"GET",headers:{"Content-Type":"application/json",...r.secret&&{Authorization:`Bearer ${r.secret}`}}});return d.ok?{success:!0,message:"连接成功",version:(await d.json()).version||"Unknown"}:{success:!1,message:`HTTP ${d.status}: ${d.statusText}`}}catch(d){return{success:!1,message:"连接失败",error:d instanceof Error?d.message:"网络错误"}}},P=r=>{b([...o,r]),i(!1),s&&!s.success&&a(o.length)},R=r=>{if(r===0)return;const d=o.filter((k,N)=>N!==r);b(d),r===t?a(0):r<t&&a(t-1)},A=r=>{i(!1),x(r)},w=()=>{x(null),i(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"API 配置管理"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"管理 Clash API 连接配置"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{variant:"outline",onClick:m,disabled:f,children:f?"检测中...":"重新检测"}),s&&e.jsx(I,{status:s.success?"success":"error",label:s.success?"当前 API 正常":"当前 API 异常"})]})]}),s&&!s.success&&e.jsx(y,{className:"border-red-200 dark:border-red-800",children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-red-800 dark:text-red-200",children:"当前 API 连接异常"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:s.message}),s.error&&e.jsx("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:s.error}),e.jsxs("div",{className:"mt-3 flex space-x-2",children:[e.jsx(h,{size:"sm",onClick:w,disabled:g||n!==null,children:"添加新的 API 配置"}),t>=0&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>A(t),disabled:n!==null||g,children:"编辑当前配置"})]})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["已配置的 API (",o.length,")"]}),!g&&n===null&&e.jsx(h,{onClick:w,children:"添加新配置"})]}),o.map((r,d)=>e.jsx($,{config:r,index:d,isSelected:d===t,onSelect:()=>a(d),onDelete:()=>R(d),onEdit:()=>A(d),onTest:()=>j(r)},`${r.baseURL}-${r.addedAt||d}`))]}),g&&e.jsx(E,{onAdd:P,onCancel:()=>i(!1)}),n!==null&&e.jsx(F,{config:o[n],onSave:r=>{const d=o.map((k,N)=>N===n?r:k);b(d),x(null)},onCancel:()=>x(null)}),e.jsxs(y,{children:[e.jsx(C,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"使用说明"})}),e.jsxs(v,{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("p",{children:"• 系统会自动检测当前 API 的连接状态"}),e.jsx("p",{children:"• 当检测到 API 连接异常时，建议添加新的 API 配置"}),e.jsx("p",{children:"• 可以添加多个 API 配置，并在它们之间切换"}),e.jsx("p",{children:"• 第一个配置是默认配置，无法删除"}),e.jsx("p",{children:"• 建议在添加配置前先测试连接"})]})]})]})};export{B as APIConfig};
